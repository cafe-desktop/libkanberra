
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - libkanberra (cppcheck 2.18.0-2)</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(cb) {
        var elements = document.querySelectorAll("." + cb.id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("id-filtered", !cb.checked);
        }

        updateFileRows();
      }

      function toggleSeverity(cb) {
        cb.parentElement.classList.toggle("unchecked", !cb.checked);
        var elements = document.querySelectorAll(".sev_" + cb.id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("severity-filtered", !cb.checked);
        }

        updateFileRows();
      }
      
      function toggleClassification(cb) {
        cb.parentElement.classList.toggle("unchecked", !cb.checked);
        var elements = document.querySelectorAll(".class_" + cb.id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("classification-filtered", !cb.checked);
        }

        updateFileRows();
      }
    
      function toggleTool(cb) {
        cb.parentElement.classList.toggle("unchecked", !cb.checked);

        var elements;
        if (cb.id == "clang-tidy")
            elements = document.querySelectorAll("[class^=clang-tidy-]");
        else
            elements = document.querySelectorAll(".issue:not([class^=clang-tidy-])");

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("tool-filtered", !cb.checked);
        }

        updateFileRows();
      }

      function toggleAll() {
        var elements = document.querySelectorAll(".idToggle");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var changed = elements[i].checked != elements[0].checked;
          if (changed) {
            elements[i].checked = elements[0].checked;
            toggleDisplay(elements[i]);
          }
        }
      }

      function filterFile(filter) {
        var elements = document.querySelectorAll(".fileEntry");

        for (var i = 0, len = elements.length; i < len; i++) {
          var visible = elements[i].querySelector("tr").querySelector("td").textContent.toLowerCase().includes(filter.toLowerCase());
          elements[i].classList.toggle("text-filtered", !visible);
        }
      }

      function filterText(text) {
        filter = text.toLowerCase();
        var elements = document.querySelectorAll(".issue");

        for (var i = 0, len = elements.length; i < len; i++) {
          var visible = false;
          var fields = elements[i].querySelectorAll("td");
          for (var n = 0, num = fields.length; n < num; n++) {
            if (fields[n].textContent.toLowerCase().includes(filter)) {
              visible = true;
              break;
            }
          }
          elements[i].classList.toggle("text-filtered", !visible);
        }

        updateFileRows();
      }

      function updateFileRows(element) {
        var elements = document.querySelectorAll(".fileEntry");

        for (var i = 0, len = elements.length; i < len; i++) {
          var visible = elements[i].querySelector(".issue:not(.id-filtered):not(.severity-filtered):not(.classification-filtered):not(.tool-filtered):not(.text-filtered)");
          elements[i].classList.toggle("file-filtered", !visible);
        }
      }

      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="wrapper">
    <div id="header" class="header">
      <h1>Cppcheck report - libkanberra (cppcheck 2.18.0-2): src/test-kanberra.c</h1>

    </div>

    <div id="menu">
     <p><a href="index.html">Defects:</a> test-kanberra.c</p>
<a href="18.html#line-34"> constParameterCallback 34</a><a href="18.html#line-54"> varFuncNullUB 54</a><a href="18.html#line-67"> varFuncNullUB 67</a><a href="18.html#line-77"> constParameterCallback 77</a><a href="18.html#line-85"> varFuncNullUB 85</a>
    </div>
    <div id="content">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><a id="line-1" name="line-1"></a><span class="cm">/*-*- Mode: C; c-basic-offset: 8 -*-*/</span>
<a id="line-2" name="line-2"></a>
<a id="line-3" name="line-3"></a><span class="cm">/***</span>
<a id="line-4" name="line-4"></a><span class="cm">  This file is part of libkanberra.</span>
<a id="line-5" name="line-5"></a>
<a id="line-6" name="line-6"></a><span class="cm">  Copyright 2008 Lennart Poettering</span>
<a id="line-7" name="line-7"></a>
<a id="line-8" name="line-8"></a><span class="cm">  libkanberra is free software; you can redistribute it and/or modify</span>
<a id="line-9" name="line-9"></a><span class="cm">  it under the terms of the GNU Lesser General Public License as</span>
<a id="line-10" name="line-10"></a><span class="cm">  published by the Free Software Foundation, either version 2.1 of the</span>
<a id="line-11" name="line-11"></a><span class="cm">  License, or (at your option) any later version.</span>
<a id="line-12" name="line-12"></a>
<a id="line-13" name="line-13"></a><span class="cm">  libkanberra is distributed in the hope that it will be useful, but</span>
<a id="line-14" name="line-14"></a><span class="cm">  WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a id="line-15" name="line-15"></a><span class="cm">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span>
<a id="line-16" name="line-16"></a><span class="cm">  Lesser General Public License for more details.</span>
<a id="line-17" name="line-17"></a>
<a id="line-18" name="line-18"></a><span class="cm">  You should have received a copy of the GNU Lesser General Public</span>
<a id="line-19" name="line-19"></a><span class="cm">  License along with libkanberra. If not, see</span>
<a id="line-20" name="line-20"></a><span class="cm">  &lt;http://www.gnu.org/licenses/&gt;.</span>
<a id="line-21" name="line-21"></a><span class="cm">***/</span>
<a id="line-22" name="line-22"></a>
<a id="line-23" name="line-23"></a><span class="cp">#ifdef HAVE_CONFIG_H</span>
<a id="line-24" name="line-24"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;config.h&gt;</span>
<a id="line-25" name="line-25"></a><span class="cp">#endif</span>
<a id="line-26" name="line-26"></a>
<a id="line-27" name="line-27"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<a id="line-28" name="line-28"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<a id="line-29" name="line-29"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;locale.h&gt;</span>
<a id="line-30" name="line-30"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="line-31" name="line-31"></a>
<a id="line-32" name="line-32"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;kanberra.h&quot;</span>
<a id="line-33" name="line-33"></a>
<a id="line-34" name="line-34"></a><span class="hll"><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="n">ka_context</span><span class="w"> </span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">userdata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="error2">&lt;--- Parameter 'userdata' can be declared as pointer to const</span>
</span><a id="line-35" name="line-35"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;callback called for id %u, error &#39;%s&#39;, userdata=%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">userdata</span><span class="p">);</span>
<a id="line-36" name="line-36"></a><span class="p">}</span>
<a id="line-37" name="line-37"></a>
<a id="line-38" name="line-38"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="line-39" name="line-39"></a><span class="w">        </span><span class="n">ka_context</span><span class="w"> </span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
<a id="line-40" name="line-40"></a><span class="w">        </span><span class="n">ka_proplist</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<a id="line-41" name="line-41"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<a id="line-42" name="line-42"></a>
<a id="line-43" name="line-43"></a><span class="w">        </span><span class="n">setlocale</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="line-44" name="line-44"></a>
<a id="line-45" name="line-45"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
<a id="line-46" name="line-46"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;create: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-47" name="line-47"></a>
<a id="line-48" name="line-48"></a><span class="w">        </span><span class="cm">/* Initialize a few meta variables for the following play()</span>
<a id="line-49" name="line-49"></a><span class="cm">         * calls. They stay valid until they are overwritten with</span>
<a id="line-50" name="line-50"></a><span class="cm">         * ka_context_change_props() again. */</span>
<a id="line-51" name="line-51"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_change_props</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>
<a id="line-52" name="line-52"></a><span class="w">                                      </span><span class="n">KA_PROP_APPLICATION_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;An example&quot;</span><span class="p">,</span>
<a id="line-53" name="line-53"></a><span class="w">                                      </span><span class="n">KA_PROP_APPLICATION_ID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.freedesktop.libkanberra.Test&quot;</span><span class="p">,</span>
<a id="line-54" name="line-54"></a><span class="hll"><span class="w">                                      </span><span class="n">KA_PROP_WINDOW_X11_SCREEN</span><span class="p">,</span><span class="w"> </span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;DISPLAY&quot;</span><span class="p">),</span><div class="verbose expandable"><span class="error2">&lt;--- Passing NULL after the last typed argument to a variadic function leads to undefined behaviour. <span class="marker">[+]</span></span><div class="content">Passing NULL after the last typed argument to a variadic function leads to undefined behaviour.
The C99 standard, in section 7.15.1.1, states that if the type used by va_arg() is not compatible with the type of the actual next argument (as promoted according to the default argument promotions), the behavior is undefined.
The value of the NULL macro is an implementation-defined null pointer constant (7.17), which can be any integer constant expression with the value 0, or such an expression casted to (void*) (6.3.2.3). This includes values like 0, 0L, or even 0LL.
In practice on common architectures, this will cause real crashes if sizeof(int) != sizeof(void*), and NULL is defined to 0 or any other null pointer constant that promotes to int.
To reproduce you might be able to use this little code example on 64bit platforms. If the output includes &quot;ERROR&quot;, the sentinel had only 4 out of 8 bytes initialized to zero and was not detected as the final argument to stop argument processing via va_arg(). Changing the 0 to (void*)0 or 0L will make the &quot;ERROR&quot; output go away.
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;

void f(char *s, ...) {
    va_list ap;
    va_start(ap,s);
    for (;;) {
        char *p = va_arg(ap,char*);
        printf(&quot;%018p, %s\n&quot;, p, (long)p &amp; 255 ? p : &quot;&quot;);
        if(!p) break;
    }
    va_end(ap);
}

void g() {
    char *s2 = &quot;x&quot;;
    char *s3 = &quot;ERROR&quot;;

    // changing 0 to 0L for the 7th argument (which is intended to act as sentinel) makes the error go away on x86_64
    f(&quot;first&quot;, s2, s2, s2, s2, s2, 0, s3, (char*)0);
}

void h() {
    int i;
    volatile unsigned char a[1000];
    for (i = 0; i&lt;sizeof(a); i++)
        a[i] = -1;
}

int main() {
    h();
    g();
    return 0;
}</div></div>
</span><a id="line-55" name="line-55"></a><span class="w">                                      </span><span class="nb">NULL</span><span class="p">);</span>
<a id="line-56" name="line-56"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;change_props: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-57" name="line-57"></a>
<a id="line-58" name="line-58"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_open</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="line-59" name="line-59"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;open: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-60" name="line-60"></a>
<a id="line-61" name="line-61"></a><span class="w">        </span><span class="cm">/* Now trigger a sound event, the quick version */</span>
<a id="line-62" name="line-62"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_play</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="line-63" name="line-63"></a><span class="w">                              </span><span class="n">KA_PROP_EVENT_ID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;desktop-login&quot;</span><span class="p">,</span>
<a id="line-64" name="line-64"></a><span class="w">                              </span><span class="n">KA_PROP_MEDIA_FILENAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/usr/share/sounds/bar.wav&quot;</span><span class="p">,</span>
<a id="line-65" name="line-65"></a><span class="w">                              </span><span class="n">KA_PROP_MEDIA_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User has logged off from session&quot;</span><span class="p">,</span>
<a id="line-66" name="line-66"></a><span class="w">                              </span><span class="n">KA_PROP_MEDIA_LANGUAGE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en_EN&quot;</span><span class="p">,</span>
<a id="line-67" name="line-67"></a><span class="hll"><span class="w">                              </span><span class="n">KA_PROP_KANBERRA_CACHE_CONTROL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;permanent&quot;</span><span class="p">,</span><div class="verbose expandable"><span class="error2">&lt;--- Passing NULL after the last typed argument to a variadic function leads to undefined behaviour. <span class="marker">[+]</span></span><div class="content">Passing NULL after the last typed argument to a variadic function leads to undefined behaviour.
The C99 standard, in section 7.15.1.1, states that if the type used by va_arg() is not compatible with the type of the actual next argument (as promoted according to the default argument promotions), the behavior is undefined.
The value of the NULL macro is an implementation-defined null pointer constant (7.17), which can be any integer constant expression with the value 0, or such an expression casted to (void*) (6.3.2.3). This includes values like 0, 0L, or even 0LL.
In practice on common architectures, this will cause real crashes if sizeof(int) != sizeof(void*), and NULL is defined to 0 or any other null pointer constant that promotes to int.
To reproduce you might be able to use this little code example on 64bit platforms. If the output includes &quot;ERROR&quot;, the sentinel had only 4 out of 8 bytes initialized to zero and was not detected as the final argument to stop argument processing via va_arg(). Changing the 0 to (void*)0 or 0L will make the &quot;ERROR&quot; output go away.
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;

void f(char *s, ...) {
    va_list ap;
    va_start(ap,s);
    for (;;) {
        char *p = va_arg(ap,char*);
        printf(&quot;%018p, %s\n&quot;, p, (long)p &amp; 255 ? p : &quot;&quot;);
        if(!p) break;
    }
    va_end(ap);
}

void g() {
    char *s2 = &quot;x&quot;;
    char *s3 = &quot;ERROR&quot;;

    // changing 0 to 0L for the 7th argument (which is intended to act as sentinel) makes the error go away on x86_64
    f(&quot;first&quot;, s2, s2, s2, s2, s2, 0, s3, (char*)0);
}

void h() {
    int i;
    volatile unsigned char a[1000];
    for (i = 0; i&lt;sizeof(a); i++)
        a[i] = -1;
}

int main() {
    h();
    g();
    return 0;
}</div></div>
</span><a id="line-68" name="line-68"></a><span class="w">                              </span><span class="nb">NULL</span><span class="p">);</span>
<a id="line-69" name="line-69"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;play: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-70" name="line-70"></a>
<a id="line-71" name="line-71"></a><span class="w">        </span><span class="cm">/* Now trigger a sound event, the complex version */</span>
<a id="line-72" name="line-72"></a><span class="w">        </span><span class="n">ka_proplist_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<a id="line-73" name="line-73"></a><span class="w">        </span><span class="n">ka_proplist_sets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">KA_PROP_EVENT_ID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;desktop-logout&quot;</span><span class="p">);</span>
<a id="line-74" name="line-74"></a><span class="w">        </span><span class="n">ka_proplist_sets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">KA_PROP_MEDIA_FILENAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/usr/share/sounds/uxknkurz.wav&quot;</span><span class="p">);</span>
<a id="line-75" name="line-75"></a><span class="w">        </span><span class="n">ka_proplist_sets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">KA_PROP_MEDIA_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;New email received&quot;</span><span class="p">);</span>
<a id="line-76" name="line-76"></a><span class="w">        </span><span class="n">ka_proplist_setf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test.foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%u&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4711</span><span class="p">);</span>
<a id="line-77" name="line-77"></a><span class="hll"><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_play_full</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="mh">0x4711</span><span class="p">);</span><span class="error2">&lt;--- You might need to cast the function pointer here</span>
</span><a id="line-78" name="line-78"></a><span class="w">        </span><span class="n">ka_proplist_destroy</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="line-79" name="line-79"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;play_full: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-80" name="line-80"></a>
<a id="line-81" name="line-81"></a><span class="w">        </span><span class="cm">/* Now trigger a sound event, by filename */</span>
<a id="line-82" name="line-82"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_play</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="line-83" name="line-83"></a><span class="w">                              </span><span class="n">KA_PROP_MEDIA_FILENAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/usr/share/sounds/freedesktop/stereo/audio-channel-front-left.ogg&quot;</span><span class="p">,</span>
<a id="line-84" name="line-84"></a><span class="w">                              </span><span class="n">KA_PROP_MEDIA_NAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Front Left&quot;</span><span class="p">,</span>
<a id="line-85" name="line-85"></a><span class="hll"><span class="w">                              </span><span class="n">KA_PROP_MEDIA_LANGUAGE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en_EN&quot;</span><span class="p">,</span><div class="verbose expandable"><span class="error2">&lt;--- Passing NULL after the last typed argument to a variadic function leads to undefined behaviour. <span class="marker">[+]</span></span><div class="content">Passing NULL after the last typed argument to a variadic function leads to undefined behaviour.
The C99 standard, in section 7.15.1.1, states that if the type used by va_arg() is not compatible with the type of the actual next argument (as promoted according to the default argument promotions), the behavior is undefined.
The value of the NULL macro is an implementation-defined null pointer constant (7.17), which can be any integer constant expression with the value 0, or such an expression casted to (void*) (6.3.2.3). This includes values like 0, 0L, or even 0LL.
In practice on common architectures, this will cause real crashes if sizeof(int) != sizeof(void*), and NULL is defined to 0 or any other null pointer constant that promotes to int.
To reproduce you might be able to use this little code example on 64bit platforms. If the output includes &quot;ERROR&quot;, the sentinel had only 4 out of 8 bytes initialized to zero and was not detected as the final argument to stop argument processing via va_arg(). Changing the 0 to (void*)0 or 0L will make the &quot;ERROR&quot; output go away.
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;

void f(char *s, ...) {
    va_list ap;
    va_start(ap,s);
    for (;;) {
        char *p = va_arg(ap,char*);
        printf(&quot;%018p, %s\n&quot;, p, (long)p &amp; 255 ? p : &quot;&quot;);
        if(!p) break;
    }
    va_end(ap);
}

void g() {
    char *s2 = &quot;x&quot;;
    char *s3 = &quot;ERROR&quot;;

    // changing 0 to 0L for the 7th argument (which is intended to act as sentinel) makes the error go away on x86_64
    f(&quot;first&quot;, s2, s2, s2, s2, s2, 0, s3, (char*)0);
}

void h() {
    int i;
    volatile unsigned char a[1000];
    for (i = 0; i&lt;sizeof(a); i++)
        a[i] = -1;
}

int main() {
    h();
    g();
    return 0;
}</div></div>
</span><a id="line-86" name="line-86"></a><span class="w">                              </span><span class="nb">NULL</span><span class="p">);</span>
<a id="line-87" name="line-87"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;play (by filename): %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-88" name="line-88"></a>
<a id="line-89" name="line-89"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sleep half a second ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="line-90" name="line-90"></a><span class="w">        </span><span class="n">usleep</span><span class="p">(</span><span class="mi">500000</span><span class="p">);</span>
<a id="line-91" name="line-91"></a>
<a id="line-92" name="line-92"></a><span class="w">        </span><span class="cm">/* Stop one sound */</span>
<a id="line-93" name="line-93"></a><span class="cm">/*     ret = ka_context_cancel(c, 0); */</span>
<a id="line-94" name="line-94"></a><span class="cm">/*     fprintf(stderr, &quot;cancel: %s\n&quot;, ka_strerror(ret)); */</span>
<a id="line-95" name="line-95"></a>
<a id="line-96" name="line-96"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sleep 2s ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="line-97" name="line-97"></a><span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="line-98" name="line-98"></a>
<a id="line-99" name="line-99"></a><span class="w">        </span><span class="cm">/* .. */</span>
<a id="line-100" name="line-100"></a>
<a id="line-101" name="line-101"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ka_context_destroy</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="line-102" name="line-102"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroy: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ka_strerror</span><span class="p">(</span><span class="n">ret</span><span class="p">));</span>
<a id="line-103" name="line-103"></a>
<a id="line-104" name="line-104"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="line-105" name="line-105"></a><span class="p">}</span>
</pre></div></td></tr></table></div>

    </div>
    <div id="footer" class="footer">
      <p>
        Created by Cppcheck 2.18.0 (<a href="https://cppcheck.sourceforge.io">Sourceforge</a>, <a href="irc://irc.libera.chat/#cppcheck">IRC</a>)
      </p>
    </div>
    </div>
  </body>
</html>
